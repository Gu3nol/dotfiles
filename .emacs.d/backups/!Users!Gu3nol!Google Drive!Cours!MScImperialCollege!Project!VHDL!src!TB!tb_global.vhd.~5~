---------------------------------------------------------
-- Top level Control Logic Unit
-- clu.vhd
-- MSc Project 2015
-- @Author: Guénolé LALLEMENT

-- This VHDL code is implemented on-chip using
-- the Cadence Encounter tool

-- It is developed for an 8x8 hexagonal pixel array
-- and characterisation array
--------------------------------------------------------

LIBRARY IEEE;

USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;
USE work.clu_pack.ALL;
USE work.ALL;

ENTITY tb_global IS
END tb_global;

ARCHITECTURE behav OF tb_global IS

  SIGNAL mclk_i, rdy_i, nrst_i                    : sl;
  SIGNAL din_i, dout_i                    : slv(15 DOWNTO 0);
  SIGNAL adc_eoc_i, adc_start_i, adc_pd_i : sl;
  SIGNAL adc_data_i                       : slv(9 DOWNTO 0);
  SIGNAL col_i, row_i                     : slv(array_size-1 DOWNTO 0);
  SIGNAL anag_mux_i                       : slv(11 DOWNTO 0);


BEGIN

  -- Declaration of the clu_inpits instance
  clu_inputs_i : ENTITY clu_inputs
    PORT MAP(
      mclk => mclk_i,
      nrst => nrst_i,
      din  => din_i
      );

  -- Declaration of the clu instance
  clu_i : ENTITY clu
    GENERIC MAP(array_size)
    PORT MAP(
      mclk      => mclk_i,
      rdy       => rdy_i,
      din       => din_i,
      dout      => dout_i,
      adc_eoc   => adc_eoc_i,
      adc_start => adc_start_i,
      adc_pd    => adc_pd_i,
      adc_data  => adc_data_i,
      col       => col_i,
      row       => row_i,
      anag_mux  => anag_mux_i
      );



  -- Master clock generation
  clkgen : PROCESS
  BEGIN
    mclk_i <= '0';
    WAIT FOR 500 ns;
    mclk_i <= '1';
    WAIT FOR 500 ns;
  END PROCESS clkgen;

  -- nReset generation
  nrstgen : PROCESS
  BEGIN
    WAIT FOR 10 ns;
    nrst_i <= '1';
    WAIT FOR 2000 ns;
    nrst_i <= '0';
    WAIT FOR 2000 ns;
    nrst_i <= '1';
    WAIT FOR 50 us;
    REPORT "All tests finished OK, terminating with failure ASSERT."
      SEVERITY failure;
  END PROCESS nrstgen;



END behav;
