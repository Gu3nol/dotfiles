\documentclass[conference]{IEEEtran}
% *** MISC UTILITY PACKAGES ***
%
\usepackage{ifpdf}
% *** CITATION PACKAGES ***
%
\usepackage{cite}
% *** GRAPHICS RELATED PACKAGES ***
%
\ifCLASSINFOpdf
  \usepackage[pdftex]{graphicx}
  % declare the path(s) where your graphic files are
  % \graphicspath{{../pdf/}{../jpeg/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  % \DeclareGraphicsExtensions{.pdf,.jpeg,.png}
\else
  % or other class option (dvipsone, dvipdf, if not using dvips). graphicx
  % will default to the driver specified in the system graphics.cfg if no
  % driver is specified.
  % \usepackage[dvips]{graphicx}
  % declare the path(s) where your graphic files are
  % \graphicspath{{../eps/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  % \DeclareGraphicsExtensions{.eps}
\fi
% *** MATH PACKAGES ***
%
\usepackage[cmex10]{amsmath}
% *** SPECIALIZED LIST PACKAGES ***
%
\usepackage{algorithmic}
% *** ALIGNMENT PACKAGES ***
%
\usepackage{array}
\usepackage{mdwmath}
\usepackage{mdwtab}
\usepackage{eqparbox}
% *** SUBFIGURE PACKAGES ***
\usepackage[tight,footnotesize]{subfigure}
%\usepackage[caption=false]{caption}
%\usepackage[font=footnotesize]{subfig}
% subfig.sty, also written by Steven Douglas Cochran, is the modern
% replacement for subfigure.sty. However, subfig.sty requires and
% automatically loads Axel Sommerfeldt's caption.sty which will override
% IEEEtran.cls handling of captions and this will result in nonIEEE style
% figure/table captions. To prevent this problem, be sure and preload
% caption.sty with its "caption=false" package option. This is will preserve
% IEEEtran.cls handing of captions. Version 1.3 (2005/06/28) and later
% (recommended due to many improvements over 1.2) of subfig.sty supports
% the caption=false option directly:
%\usepackage[caption=false,font=footnotesize]{subfig}
%
% The latest version and documentation can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/subfig/
% The latest version and documentation of caption.sty can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/caption/
% *** FLOAT PACKAGES ***
%
\usepackage{fixltx2e}
\usepackage{stfloats}
% *** PDF, URL AND HYPERLINK PACKAGES ***
%
\usepackage{url}
% *** VARIOUS PACKAGES ***
\usepackage{upgreek}
\usepackage{amssymb}
\usepackage{sistyle}
\usepackage{tabularx}
\usepackage{csquotes}

%\overfullrule=2cm

% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor linearity}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Document                                                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                           Title and author                                                                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Full Custom Design of a Digital-to-Analogue Converter in 0.18 $\upmu$m CMOS}
% author names and affiliations
\author{\IEEEauthorblockN{Gu\'enol\'e Lallement }
\IEEEauthorblockA{Department of Electrical and Electronic Engineering\\
Imperial College London,\\
SW7 2BT, UK\\
Email: guenole.lallement14@imperial.ac.uk -- CID: 009987468}
}
\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Abstract                                                                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
%\boldmath

Abstract here

\end{abstract}
\IEEEpeerreviewmaketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Introduction                                                                     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
Digtial-to-Analog converters -- DAC -- are common integrated circuits in signal processing that helps to link the digital domain with the analog world.\cite{ref:Pelgrom} A DAC of small area, low power consumption with standard resolution (8 to 10 bits) are useful for many applications.

In CMOS technology, the binary-weighted charge-scaling DAC is one of the most widely used data converters due to its precision and efficiency. Others common architectures -- resistive DAC, R-2R ladder topology, current-steering DAC and cyclic DAC -- have been analyzed to respect the specifications. Yet, the split array charge-scaling DAC presents a high-resolution/frequency, a low power dissipation, a relative low die area and is able to be trimmed or calibrated after manufacture.

Although the charge-scaling DAC presents many advantages, the implementation of this topology is challenging regarding all the matching considerations.\cite{ref:Hasting}\cite{ref:Hsiao} By selecting the precise values of the capacitors and transistors and using matching techniques, the designers must ensure the parasitic capacitances and digital noise have no influences over the accuracy of the converter.

Section II describes the concept and operation of the proposed architecture for this work. Section III shows the circuit level implementation. Lastly, section IV presents the simulation results followed by the propose realization in 0.18 $\upmu$m technology.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                             System Overview                                                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{System Overview}
%For this coursework, we are required to design a complete DAC with serial input. In this section, the chosen system architecture to meets the required specifications is described.
\begin{figure}[!ht]
\centering
\includegraphics[scale=0.35]{illustrations/Block_diag.png}
\caption{\label{Block_dig} Top level architecture of the DAC - Block diagram}
\end{figure}

According to the top level block diagram of the DAC, shown in figure \ref{Block_dig}., there are two main sub-systems. A digital interface is used to receive the serial data via the digital input \textit{SI} and converts them into parallel data D[0:7]. The digital interface also generates a precise 10 MHz reference clock \textit{CLK} for synchronisation with the input signal \textit{EN}. The other sub-system is strictly speaking a DAC initiated by \textit{EN} signal to convert the digital input from a digital code to the analog output \textit{VOUT}.

Any required voltage references are generated on chip using the analogue voltage reference \textit{VREF} at 0.9V.

\subsection{Split Array Charge-Scaling DAC}
The charge-scaling DAC are based on the principle of the binary division through a parallel array of binary-weighted capacitors, according to a digital bit input word. Shown in Baker's book \cite[p.~215]{ref:Baker} the architecture which serves to illustrate the principle of conversion and explains the operation of the circuit.

Although the charge-scaling architecture is simple with relatively good accuracy -- high resolution of 10 to 12 bit can be achieved -- as the resolution needed increases, the size ratio between LSB and MSB capacitors becomes a major issue in term of area and parasitic capacitances. One solution to reduce the size of the capacitors is used in this paper. By introducing a split array and an additional attenuation capacitor, the original array is split into a LSB array and a MSB array, as shown in figure \ref{SC_sch}.

Moreover, to respect the specification of an output voltage range between 0.4 and 1.4 V, the voltage references  $V_{ref+}$ and $V_{ref-} $ have been settled for these two values. As a consequence, each capacitor is charged to either 0.4 or 1.4V. The \textit{RESET} signal is directly generated using \textit{EN}.

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.17]{illustrations/SC_DAC.png}
\caption{\label{SC_sch} A charge-scaling DAC using a split array}
\end{figure}

The value of the attenuation capacitor is given by;
\begin{center}
   $C_{atten} = \frac{sum~of~the~LSB~array~capacitors}{sum~of~the~MSB~array~capacitors} \cdot C_{unit}$
\end{center}

\bigbreak
At this step, it should be pointed out that the design of the output buffered OpAmp is very important and closely related to the sizing of the capacitors. Indeed, the design of the OpAmp need to ensure a 0dB close-loop gain and stable operation.

\subsection{Serial to Parallel Converter}
The charge-scaling DAC architecture works with a parallel digital input. As the digital signal on \textit{SI} is received in serial, with \textit{LSB} first, a digital interface is required to convert these data from serial-to-parallel. Moreover, \textit{EN} actives high indicates the data on \textit{SI} will be ready, so to ensure the proper functioning of the converter, the digital input has to be stored only when \textit{EN} is high. A simple solution to do so is by using a shift register with enable signal. An implementation will be described in section III.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                       Circuit Implementation                                                        %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Circuit Implementation}
This section describes the circuit implementation derived from the system overview.

\subsection{Serial-to-Parallel Converter}
According to the specification a simple shift register could not be used in our case. The SP converter needs to 'SAMPLE' but also to 'HOLD' the values at the right time. As a result, the valid input data on the SP converter are held until the next conversion cycle and the input data on the split array keep their state during the charge of the capacitors. This topology is justified by the frequency of the input data which is too high to directly charge the capacitors, which cannot be too small for parasitics reasons.

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.21]{illustrations/DAC_SP.png}
\caption{\label{DAC_SP} 8-bits shift register with \textit{EN} signal.}
\end{figure}

The SP converters is an 8-bits shift register that includes 8  positive-edge triggered D-type flip-flop with Enable signal (DFF-EN). For a single DFF-EN, when \textit{EN} is high, the cell works as a simple DFF and when \textit{EN} is low, the output \textit{Q} of the DFF is fed into the input \textit{D}. The DFF-EN works as a memory cell when \textit{EN} is low. As shown in figure \ref{DAC_SP}, each output \textit{Q} of the DFF-EN represent a bit from MSB to LSB.

\subsection{Charge-Scaling DAC}
\subsubsection{Capacitors and Attenuation Capacitor}
To implement the charge-scaling DAC, it is essential for good matching issues between the attenuation capacitor and the charge-splitting capacitances to construct all the capacitor using a unit capacitor $C_{unit}$.

As described in \cite{ref:Hasting}, the minimum size that ensures matching between capacitors is 20$\upmu$m$\times$20$\upmu$m. The existence of a parasitic capacitance at the top plate of the capacitor array due to the op-amp and the area specification also determine the size of the capacitances.

In order to respect those conditions, the attenuation capacitor is designed using series and parallel combinations with the minimum number of $C_{unit}$ capacitances (7 capacitors are used).

\begin{center}
   $C_{atten} = \left( \frac{2}{3} + \frac{2}{5} \right) \cdot C_{unit} =\frac{16}{15} \cdot C_{unit}$
\end{center}
\bigbreak

\subsubsection{OpAmp}
To ensure the good operation of the DAC and the voltage regulators, a two stages OpAmp -- using a compensation capacitor -- has been implemented. As high open-loop gain and high gain bandwidth product is requested, the transistors parameters of the 1$^{st}$ and the 2$^{nd}$ stage of the OpAmp have to be precisely settled.\cite{ref:Tsividis&Gray}

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.3]{illustrations/DAC_OpAmp.png}
\caption{\label{DAC_OpAmp} Two stages OpAmp with compensation capacitor}
\end{figure}

The design procedure is inspired from \cite{ref:Mahattanakul}. By sizing larger critically transistors the matching has been taken into account. The size of the transistors of the differential pair are $L_{n} $ = 2$\upmu$m and $W_{n} $ = 8$\upmu$m. To improve stability and reduce ripples at the output\cite{ref:Palmisano&Paumbo}, a compensation capacitor $C_{c}  = 460 fF$ is used. However, the OpAmp is set to present an intermediate quality factor $Q = \frac{1}{2}$ -- it is critically damped -- to improve speed. To drive the required output load, the transistors sizes of the buffer stage are chosen larger.

The simulation results show that the OpAmp presents an open-loop gain of 60 dB, with a cut-off frequency $f_{c} $ = 10 kHz and a phase margin $\Phi$M = 50$\arcdeg$.

\subsubsection{Biasing circuit}
To work properly, the designed two stage OpAmp needs a biasing circuit. From \cite{ref:Baker}\cite{ref:Razavi}\cite{ref:Johns&Martin}, the design of a $\beta$-multiplier circuit has been selected to provide a biasing current $I_{bias} $ = 8$\upmu$A required by the OpAmp. To ensure, to proper function of the $\beta$-multiplier, a start-up circuit has been added to \enquote*{kick start} the system.

%\begin{figure}[!ht]
%\centering
%\includegraphics[scale=0.23]{illustrations/DAC_OpAmp_Biais.png}
%\caption{\label{DAC_OpAmp_Biais} $\beta$-multiplier circuit use as biasing source for the OpAmp.}
%\end{figure}

\subsection{Other sub-systems}
\subsubsection{Output clock}
A ring oscillator -- time delay oscillator that uses an odd number of inverters attached in a chain -- with 5 stages has been designed to produce an output oscillation frequency of 10 MHz at 27$\degC$. To set the inverters sizes and reach the correct oscillation frequency, with minimum skew or jitter, the delay between each stage has been increased. Figure \ref{RO_sch} presents the architecture of the DAC's 10 MHz clock.

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.21]{illustrations/DAC_OUT_CLOCK.png}
\caption{\label{RO_sch}Schematic of the Ring Oscillator}
\end{figure}

\subsubsection{Voltage references}
In order to produce an analogue output for the DAC from 0.4V to 1.4V, the system needs to create these two references from the input voltage reference \textit{VREF} = 0.9V. To ensure this, two differential amplifier circuits have been used. A non-inverting amplifier circuit produces the voltage reference $V_{ref+} $ = 1.4V, and an inverting amplifier produces $V_{ref-} $ = 0.4V.

%In both cases, the differential amplifier used is the same OpAmp as in the charge-scaling circuit. The buffer of the OpAmp helps to drive the capacitive loads in the charge-scaling array.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Simulated Results                                                          %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Simulated Results}
\subsection{Test Strategy}
To verify the correct operation of the circuit/sub blocks and show that they work as expected different test benches have been used. The main one is presented of figure \ref{TB_GLOBAL_DAC}. This one contains all the power supply required by the DAC to operate and a load to respect the specifications. A ready-to-use veriloga module has been provided to generate input data on \textit{SI} and the signal \textit{EN} at the specified frequency (cf. table\ref{technical_spec}). The module also produces reference output through \textit{VOUTREF} and \textit{CLK10MREF}.
\begin{figure}[!ht]
\centering
\includegraphics[scale=0.22]{illustrations/TB_GLOBAL_DAC.png}
\caption{\label{TB_GLOBAL_DAC}Main test bench of the DAC}
\end{figure}

\subsection{Simulated Results and Achieved Specifications}
From the output characteristic of the DAC in figure \ref{DAC_OUT} we are able to estimate the relative error of the system.
\begin{center}
$VOUT = \frac{CODE[7:0]}{255} + 0.4$
\end{center}
\begin{center}
$ERR_{rel} = \frac{|VOUT_{ideal} - VOUT_{out}|}{VOUT_{ideal}}$
\end{center}

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.24]{illustrations/DAC_OUT.png}
\caption{\label{DAC_OUT} Input/Output characteristic for the DAC}
\end{figure}

Table \ref{technical_spec} presents all the specifications extracted from the simulation and compared to the target specifications.
\begin{table}[!ht]
% increase table row spacing, adjust to taste
\renewcommand{\arraystretch}{1.3}
\caption{Technical specifications}
\label{technical_spec}
\centering
\begin{tabular}{p{0.85cm}  p{2cm}  p{1.1cm}  p{1.5cm}  p{1cm}}
\hline
Name & Specifications & Targeted value & Simulated value & Units\\
\hline
Area & Total silicon area & $\leqslant$ 1 & 0.045 & mm$^{2}$\\

%VDD & Power supply & 1.8 & 1.8 & V\\

$P_{diss} $  & Power dissipation & $\leqslant$ 10 & $\leqslant$ 0.5 & mW\\

$f_{clk} $  & Output clock frequency & 10 & 10 $\pm$ 0.01\%  & MHz\\

$f_{s} $  & Conversion rate & 10 & 10  & kHz\\

R  & Output voltage range & 0.4 - 1.4 & 0.4 - 1.4  & V\\

$Z_{l} $  & Load impedance for VOUT & 10 // 10 & 10 // 10  & k$\ohm$ // pF \\

$ER_{rel} $  & Relative error & $\leqslant$ 1.5 & $\leqslant$ 0.04  & $\%$ \\

INL  & Integral Non Linearity & $\leqslant$ 1/2 & $\leqslant$ 0.001 & LSB \\

DNL  & Differential Non Linearity & $\leqslant$ 1/2 & $\leqslant$ 0.03 & LSB \\
\hline
\end{tabular}
\end{table}

The final proposed design succeeded to beat all the targeted technical specifications with $\leqslant$ 0.04 \% of relative error, a power consumption of $\leqslant$ 0.5 mW, and a possible silicon area of implementation of 0.045 mm$^{2}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Realisation                                                                      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Realisation}

\subsection{Matching Consideration: The OpAmp}
To improve the yield and matching of the transistors of the OpAmp \& biasing circuit, techniques such as interdigitation, dummy devices and guard rings have been used. It protects all the transistors that need to be critically matched, especially the input differential pair.

\subsection{Matching Consideration: The Charge-Splitting Capacitance}
As the precision of the capacitive ratio is essential for the performance of the DAC\cite{ref:Moon&Temes}, it is important to generate a highly matched common-centroid layout with minimum parasitic capacitance induced from routing. Moreover, the ratio of the capacitor array must be kept close to 1.

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.31]{illustrations/SC_array.png}
\caption{\label{SC_array}Common centroid configuration of the capacitive array}
\end{figure}

The configuration of figure \ref{SC_array} has been used for this work. It ensures the maximum matching between the capacitance of the array (attenuation capacitances + LSB/MSB capacitances) and the global symmetry of the array (metal path + capacitances). Dummy capacitance and guard rings have been included to reach a uniform etching.

\subsection{Floorplan and Layout}
The figures \ref{DAC_floorplan} and \ref{DAC_layout} present the proposed implementation of the system using the gpdk180 technology from Cadence Virtuoso.  The analog part and digital part of the system are as far away as possible to avoid parasitic influences and noise coupling. Substrate/well contacts have been added as much as possible to maintain the potential to the ground and sink spontaneous current.

The utilisation of metal paths have been properly thought to respect the rules of a \enquote*{good analog layout}. \cite{ref:Hasting}\cite{ref:Allen&Holdberg}

\begin{figure}[!ht]
\centering
\includegraphics[scale=0.44]{illustrations/floorplan.png}
\caption{\label{DAC_floorplan}Layout floorplan of the DAC}
\end{figure}
\begin{figure}[!ht]
\centering
\includegraphics[scale=0.11]{illustrations/DAC_layout.png}
\caption{\label{DAC_layout}Layout of the DAC - Length = 156.4 $\upmu$m and Width =  291.8 $\upmu$m}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Conclusion                                                                      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Conclusion}
In this report an implementation of the split array charge-scaling DAC was presented. It used a split array of capacitors to convert the data from digital to analog. Although the parasitic and matching analysis were not required, both device matching and parasitic optimization have been taken into particular consideration for the design/implementation of the system.

The experimental results have shown that the DAC beats all the targeted specifications with relative margins.  In a conventional IC design process, the next step of this work would be to realize a post-layout-simulation and a parasitic extraction to improve and correct the proposed architecture.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                            Reference section                                                           %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{11 }

%1
 \bibitem{ref:Pelgrom}
M.J.M.~Pelgrom, \emph{Analog-to-Digital Conversion},
Dordrecht : Springer, 2010.

%2
\bibitem{ref:Hasting}
A.~Hasting, \emph{The art of analog	layout}, 2nd~ed.
Upper Saddle River: Pearson Prentice Hall, 2006.

%3
\bibitem{ref:Hsiao}
W.H~Hsiao \& Y.T~He et all., \emph{Automatic common-centroid layout generation for binary-weighted capacitors in charge-scaling DAC},
International Conference on Synthesis, Modeling, Analysis and Simulation Methods and Applications to Circuit Design, pp. 173-176, 2012.

%4
\bibitem{ref:Baker}
R.~Jacob Baker, \emph{CMOS Circuit Design Layout, and Simulation}, 3rd~ed.
Hoboken, NJ: John Wiley \& Sons, Inc., 2010.

%5
\bibitem{ref:Tsividis&Gray}
Y.~Tsividis \& P.~Gray, \emph{An integrated NMOS operational amplifier with internal compensation},
IEEE J. Solid-State Circuits, vol. SC-11, pp. 748-754, Dec. 1976.

%6
\bibitem{ref:Mahattanakul}
J.~Mahattanakul, \emph{Design Procedure for Two-Stage CMOS Operational Amplifiers Employing Current Buffer},
IEEE Trans. Circuits Syst. II, Express Briefs, vol. 52, no. 11, pp 766-770, Nov. 2005.

%7
\bibitem{ref:Palmisano&Paumbo}
G.~Palmisano \& G.~Paumbo, \emph{A compensation strategy for two-stage CMOS opamps based on current buffer},
IEEE Trans. Circuits Syst. I, Fundam. Theory Appl., vol. 44, no. 3, pp. 257-262, Mar. 1997.

%8
\bibitem{ref:Razavi}
B.~Razavi, \emph{Design of Analog CMOS Integrated Circuits}, International ed.
Boston, Mass. ; London : McGraw-Hill, 2002.

%9
\bibitem{ref:Johns&Martin}
D.~Johns \& K.W.~Martin, \emph{Analog integrated circuit design}, International ed.
Boston, Mass. ; London : McGraw-Hill, 2002.


%10
\bibitem{ref:Moon&Temes}
U.K.~Moon \& G.C.~Temes \& J.~Steensgaard, \emph{Digital Techniques for Improving the Accuracy of Data Converters},
IEEE Communications Magazine, pp.~136-143, 1999

%11
\bibitem{ref:Allen&Holdberg}
P.E.~Allen \& D.R.~Holdberg, \emph{CMOS analog circuit design}, 2nd~ed.
New York ; Oxford : Oxford University Press, 2002.

\end{thebibliography}

% that's all folks
\end{document}
