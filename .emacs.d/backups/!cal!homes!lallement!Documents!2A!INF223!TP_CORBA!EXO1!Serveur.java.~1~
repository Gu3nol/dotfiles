package tpcorba;

import org.omg.CORBA.*;
import java.util.*;
import java.io.*;
import java.lang.*;

public class Serveur 
{
    public static void main(String args[]) throws IOException
    { 
	///////////////////////////////////////
	// Initialisation de l'ORB et du POA //
	///////////////////////////////////////
	
        org.omg.CORBA.ORB orb = org.omg.CORBA.ORB.init (args, null);

        org.omg.CORBA.Object objPoa = null;
        org.omg.PortableServer.POA rootPOA = null;
	
        try
	    {
		objPoa = orb.resolve_initial_references ("RootPOA");
	    }
        catch (org.omg.CORBA.ORBPackage.InvalidName ex)
	    {
		System.out.println ("RootPOA est introuvable!");
		System.exit (1);
	    }
	
        rootPOA = org.omg.PortableServer.POAHelper.narrow (objPoa);
	
	/////////////////////////////
	// Instantation de l'objet //
	/////////////////////////////
	
	calculImpl calc = new calculImpl ();

        try
        {
            org.omg.CORBA.Object obj = calc._this (orb);
	    
            String reference = orb.object_to_string( obj );

            try
		{
		    java.io.FileOutputStream file 
			= new java.io.FileOutputStream ("calcul.ref");
		    java.io.PrintStream pfile 
			= new java.io.PrintStream (file);
		    pfile.println (reference);
		    file.close ();
            }
            catch (java.io.IOException ex)
		{
		    System.out.println ("Erreur lors de l'ouverture du fichier");
		}

            rootPOA.the_POAManager().activate();

            System.out.println ("Le serveur est prêt...");

            orb.run ();
        }
        catch (java.lang.Exception ex)
        {
            System.out.println ("Une exception a été interceptée");
            ex.printStackTrace ();
        }

    }
}


