# OPTION DE COMPILATION
CC	     = arm-none-eabi-gcc
AS       = arm-none-eabi-as
OBJDUMP  = arm-none-eabi-objdump

LDSCRIPT = ldscript
OFILES   = boot.o serial.o utils.o init.o leds.o timer.o gpio.o buzzer.o boot_loader.c crt0.o

CFLAGS	 = -Wall -Wextra -Werror -O1 -g -nostdlib -std=gnu99
LDFLAGS  = $(shell $(CC) -print-libgcc-file-name) -T

#all : hello.lst boot.elf
all : boot.elf

.PHONY : clean

# Production du .lst
#boot.lst : boot.elf
#	@$(OBJDUMP) -D $^ > $@
#	@sed -i '/Disassembly/d' $@
#	@sed -i '/elf/d' $@
#	@sed -i '/./!d' $@

# Production des fichiers objets
boot.elf : $(OFILES) $(LDSCRIPT)
	$(CC) $(CFLAGS) $(OFILES) $(LDFLAGS) $(LDSCRIPT) -o $@

clean:
	rm -f *.o *.elf *.lst
