---------------------------------------------------------
-- Testbench for the Analog Mux
-- tb_mux.vhd
-- MSc Project 2015
-- @Author: Guénolé LALLEMENT

-- This VHDL code is for testing purpose

-- It is developed for an 12 switches selector
--------------------------------------------------------

LIBRARY IEEE;

USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY tb_mux IS
  PORT(
    -- Columns/Row signals
    switches : OUT std_logic_vector(11 DOWNTO 0);
    );
END tb_mux;

ARCHITECTURE behav OF tb_dec IS
  -- Array coordinate
  SIGNAL anag_coord : std_logic_vector(3 DOWNTO 0);


  -- One hot decoder functions
  FUNCTION one_hot_dec_row(array_coord : std_logic_vector(5 DOWNTO 0)) RETURN integer IS
    VARIABLE num_row : integer;
  BEGIN
    num_row := To_integer(unsigned(array_coord(5 DOWNTO 3)));
    RETURN num_row;
  END FUNCTION one_hot_dec_row;

  FUNCTION one_hot_dec_col(array_coord : std_logic_vector(5 DOWNTO 0)) RETURN integer IS
    VARIABLE num_col : integer;
  BEGIN
    num_col := To_integer(unsigned(array_coord(2 DOWNTO 0)));
    RETURN num_col;
  END FUNCTION one_hot_dec_col;

BEGIN

  output_process : PROCESS(array_coord)
  BEGIN
    row                               <= (OTHERS => '0');
    col                               <= (OTHERS => '0');
    row(one_hot_dec_row(array_coord)) <= '1';
    col(one_hot_dec_col(array_coord)) <= '1';
  END PROCESS output_process;

  array_coord_process : PROCESS
  BEGIN
    WAIT FOR 500 ns;
    array_coord <= (OTHERS => '0');

    FOR i IN 0 TO 64 LOOP
      WAIT FOR 1 us;
      array_coord <= std_logic_vector(to_unsigned(i, array_coord'length));
    END LOOP;

    REPORT "All tests finished OK, terminating with failure ASSERT."
      SEVERITY failure;


  END PROCESS array_coord_process;

END behav;
